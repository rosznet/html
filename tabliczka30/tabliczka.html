<!DOCTYPE html>
<html lang="pl">
<head>
    <title>Tabliczka mnożenia do 30</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <link rel="manifest" href="manifest.json">

    <style>
@media (max-width: 1000px) {
  body {
    font-size: 14px;
  }
}
@font-face {
    font-family: 'Digital-7';
    src: url('Digital-7.ttf') format('truetype');
}
body {
    background-color: #333; /* dark grey */
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    padding: 0;
    flex-direction: column;
}
#operation {
    font-family: 'Digital-7';
    color: white;
    font-size: 100px;
}
#userInput {
    border-radius: 6px;
    font-family: 'Digital-7';
    color: white;
    border: lightgrey 3px solid;
    background: none;
    outline: none;
    font-size: 100px;
    max-width: 180px;
    box-shadow: none;
    border: 2px solid white;
}
button {
    border-radius: 6px;
    font-size: 24px;
    padding: 10px 20px;
    margin: 10px;
    min-width: 500px;
    background-color: darkgrey;
}
#indexDisplay {
    border-radius: 6px;
    position: fixed;
    right: 0;
    bottom: 0;
    padding: 10px;
    margin-bottom: 10px;
    margin-right: 10px;
    background-color: #747474;
    color: white;
}
#bravoImage {
    border-radius: 6px;
    display: none;
    position: fixed;
    right: 0;
    top: 0;
}
    </style>

</head>
<body>
    <p>
        <span id="operation"></span>
        <input type="tel" id="userInput" maxlength="3" placeholder="?">
    </p>
    <div id="indexDisplay"/>

	<script>
	    if ('serviceWorker' in navigator) {
	      window.addEventListener('load', function() {
	            navigator.serviceWorker.register('/service-worker.js');
	      });
	    }
	
		function secureRandom() {
		    if (window.crypto && window.crypto.getRandomValues) {
		        let array = new Uint32Array(1);
		        window.crypto.getRandomValues(array);
		        return array[0] / 4294967295;
		    } else {
		        return Math.random();
		    }
		}

        document.addEventListener('DOMContentLoaded', (event) => {
            var number1;
            var number2;
            var userInput = document.getElementById('userInput');
            var indexOnList = 0;
            var pairs = [];

            function generateListOfMultiplications() {
                for (var i = 1; i <= 10; i++) {
                    for (var j = 1; j <= 3; j++) {
                        pairs.push([i, j]);
                    }
                }
            }
            
            function shuffleListOfMultiplications() {
                var shuffledPairs = new Array(pairs.length);
                var orderedPairs = pairs.slice();
                
                for (var i = 0; i < shuffledPairs.length; i++) {
                    var pair = orderedPairs.pop();
                    var index = Math.floor(secureRandom() * shuffledPairs.length);
                    while (shuffledPairs[index] !== undefined) {
                        index = Math.floor(secureRandom() * shuffledPairs.length);
                    }
                    shuffledPairs[index] = pair;
                }
                pairs = shuffledPairs;
            }


            function next() {
                if (indexOnList >= pairs.length) {
                    alert("Brawo! Tabliczka mnożenia do 30 skończona.");
                    indexOnList = 0;
                    shuffleListOfMultiplications();
                }

                number1 = pairs[indexOnList][0];
                number2 = pairs[indexOnList++][1];
                userInput.style.color = "white";
                userInput.value = "";
                document.getElementById('operation').textContent = number1 + "*" + number2 + "=";
                document.getElementById('indexDisplay').textContent = indexOnList;
                userInput.focus();
            }

			// Input event listener
			userInput.addEventListener('input', function(e) {
			    var nonNumeric = /[^0-9]/g;
			    if (nonNumeric.test(e.target.value)) {
			        e.target.value = e.target.value.replace(nonNumeric, '');
			    }
			    if (e.target.value > 30) {
			        e.target.value = '';
			    }
			    if (e.target.value === '') {
			        e.target.style.color = 'white';
			    } else {
			        e.target.style.color = ''; // Reset to default color when there's input
			    }
			
			    // Check the answer for every valid input
			    if (userInput.value.length > 0) {
			        if (userInput.value == (number1 * number2)) {
			            userInput.style.color = "green";
			            next();
			        } else {
			            userInput.style.color = "lightcoral";
			        }
			    }
			});

            generateListOfMultiplications();
            shuffleListOfMultiplications();
            next(); 
        });
    </script>
</body>

</html>

