<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <link rel="manifest" href="manifest.json">
  <title>Ping Pong licznik</title>
<style>
  :root {
    --bg: #000;
    --fg: #fff;
    --line: #fff;
    --center-points-size: 200pt;
    --area-height: 70vh;
  }

  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    font-size: 150pt;
    font-family: 'Digital-7', system-ui, sans-serif;
    overflow: hidden;
  }

  @font-face {
    font-family: 'Digital-7';
    src: url('Digital-7.ttf') format('truetype');
  }

  #hud {
    text-align: center;
    padding: 12px;
  }

  #setsDisplay {
    font-size: 50pt;
    font-family: 'Digital-7', system-ui, sans-serif;
  }

  .play-area {
    display: flex;
    height: var(--area-height);
    align-items: stretch;
  }

  .half {
    flex: 1;
    position: relative;
    background: var(--bg);
    min-width: 0;
  }

  .center-line {
    width: 6px;
    background: var(--line);
  }

  .center-counter {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--center-points-size);
    color: var(--fg);
  }

  @media (max-width: 480px) {
    :root {
      --center-points-size: 100px;
    }
  }
</style>
</head>
<body>
  <div id="hud">
    <div id="setsDisplay">
	<span id="setsA">0</span>:<span id="setsB">0</span></div>
  </div>

  <div class="play-area" role="region">
    <div class="half" id="left"><div class="center-counter" id="midA">0</div></div>
		<div class="center-line"></div>
    <div class="half" id="right"><div class="center-counter" id="midB">0</div></div>
  </div>

  <script>

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js');
      });
    }

    const POINTS_TO_WIN = 11, MUST_WIN_BY = 2, DEBOUNCE_MS = 3000;
    let pointsA = 0, pointsB = 0, setsA = 0, setsB = 0, lastTap = 0;

    const elMidA = document.getElementById('midA');
    const elMidB = document.getElementById('midB');
    const elSetsA = document.getElementById('setsA');
    const elSetsB = document.getElementById('setsB');
    const left = document.getElementById('left');
    const right = document.getElementById('right');
    const hud = document.getElementById('hud');

    function updateHUD(){
      elMidA.textContent = pointsA;
      elMidB.textContent = pointsB;
      elSetsA.textContent = setsA;
      elSetsB.textContent = setsB;
    }

    function checkSetEnd(){
      if ((pointsA >= POINTS_TO_WIN || pointsB >= POINTS_TO_WIN) && Math.abs(pointsA - pointsB) >= MUST_WIN_BY) {
			if (pointsA > pointsB){ 
					setsA++;
				} else { 
					setsB++; 
				}
				
				updateHUD(); setTimeout(startNewSet,1500); return true;
		  }
		  return false;
    }

    function startNewSet(){ 
		pointsA = 0; 
		pointsB = 0; 
		updateHUD(); 
	}

    function awardPoint(side){
      const now = Date.now(); if (now - lastTap < DEBOUNCE_MS) return; lastTap = now;
      if (side === 'A') pointsA++; else pointsB++;
      updateHUD(); 
	  checkSetEnd();
    }

    function handlePointer(evt, side){
      evt.preventDefault();
      awardPoint(side);
    }

    left.addEventListener('mousedown', (e)=>handlePointer(e,'A'));
    right.addEventListener('mousedown', (e)=>handlePointer(e,'B'));

    hud.addEventListener('mousedown', (e)=>{
		  e.stopPropagation();
		  pointsA = pointsB = setsA = setsB = 0;
		  updateHUD();
    });

    updateHUD();
  </script>
</body>
</html>
