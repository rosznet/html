<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <link rel="manifest" href="manifest.json">
  <title>Ping Pong licznik</title>
<style>
  :root {
    --bg: #000;
    --fg: #fff;
    --line: #fff;
    --hud-padding: 12px;
    --center-points-size: 400pt;
    --area-height: 70vh;
  }

  html, body {
    height: 100%;
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    font-size: 150pt;
    font-family: 'Digital-7', system-ui, sans-serif;
    overflow: hidden;
  }

  @font-face {
    font-family: 'Digital-7';
    src: url('Digital-7.ttf') format('truetype');
  }

  #hud {
    text-align: center;
    padding: var(--hud-padding);
  }

  #setsDisplay {
    font-size: 50pt;
    font-weight: 700;
    font-family: 'Digital-7', system-ui, sans-serif;
  }

  #msg {
    height: 20px;
    margin-top: 6px;
  }

  .play-area {
    display: flex;
    height: var(--area-height);
    align-items: stretch;
  }

  .half {
    flex: 1;
    position: relative;
    background: var(--bg);
    min-width: 0;
  }

  .center-line {
    width: 2px;
    background: var(--line);
  }

  .center-counter {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--center-points-size);
    font-weight: 700;
    color: var(--fg);
  }

  .controls {
    text-align: center;
    padding: 12px;
  }

  button {
    padding: 8px 12px;
    margin-right: 8px;
  }

  @media (max-width: 480px) {
    :root {
      --sets-size: 36px;
      --center-points-size: 52px;
    }
  }
</style>
</head>
<body>
  <div id="hud">
    <div id="setsDisplay"><span id="setsA">0</span><span style="margin:0 12px;">:</span><span id="setsB">0</span></div>
    <div id="msg"></div>
  </div>

  <div class="play-area" role="region" aria-label="Pole gry">
    <div class="half" id="left"><div class="center-counter" id="midA">0</div></div>
    <div class="center-line" aria-hidden="true"></div>
    <div class="half" id="right"><div class="center-counter" id="midB">0</div></div>
  </div>

  <div class="controls">
    <button id="resetMatch">Resetuj mecz</button>
  </div>

  <script>

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
            navigator.serviceWorker.register('/service-worker.js');
      });
    }

    const POINTS_TO_WIN = 11, MUST_WIN_BY = 2, DEBOUNCE_MS = 200;
    let pointsA = 0, pointsB = 0, setsA = 0, setsB = 0, lastTap = 0;

    const elMidA = document.getElementById('midA');
    const elMidB = document.getElementById('midB');
    const elSetsA = document.getElementById('setsA');
    const elSetsB = document.getElementById('setsB');
    const elMsg = document.getElementById('msg');
    const left = document.getElementById('left');
    const right = document.getElementById('right');
    const resetMatch = document.getElementById('resetMatch');

    function updateHUD(){
      elMidA.textContent = pointsA;
      elMidB.textContent = pointsB;
      elSetsA.textContent = setsA;
      elSetsB.textContent = setsB;
    }

    function checkSetEnd(){
      if ((pointsA >= POINTS_TO_WIN || pointsB >= POINTS_TO_WIN) && Math.abs(pointsA - pointsB) >= MUST_WIN_BY){
        if (pointsA > pointsB){ setsA++; elMsg.textContent = 'A wygra³'; } else { setsB++; elMsg.textContent = 'B wygra³'; }
        updateHUD(); setTimeout(startNewSet,1200); return true;
      }
      return false;
    }

    function startNewSet(){ pointsA = 0; pointsB = 0; elMsg.textContent = ''; updateHUD(); }

    function awardPoint(side){
      const now = Date.now(); if (now - lastTap < DEBOUNCE_MS) return; lastTap = now;
      if (side === 'A') pointsA++; else pointsB++;
      updateHUD(); checkSetEnd();
    }

    function handlePointer(evt, side){
      // zapobiegamy przyznawaniu punktu jeœli zdarzenie pochodzi z kontrolki UI (np. button)
      if (evt.target.closest('.controls')) return;
      evt.preventDefault();
      awardPoint(side);
    }

    function globalTapHandler(e){
      // jeœli klikniêcie/tap pochodzi z elementu w .controls, ignoruj
      const target = e.target || e.srcElement;
      if (target.closest && target.closest('.controls')) return;
      const x = (e.touches && e.touches[0]) ? e.touches[0].clientX : (e.clientX || window.innerWidth/2);
      if (x < window.innerWidth/2) awardPoint('A'); else awardPoint('B');
    }

    // obs³uga zdarzeñ tylko na polach oraz globalna jako zapas, ale ka¿dorazowo sprawdzamy element Ÿród³owy
    left.addEventListener('touchstart', (e)=>handlePointer(e,'A'), {passive:false});
    right.addEventListener('touchstart', (e)=>handlePointer(e,'B'), {passive:false});
    left.addEventListener('mousedown', (e)=>handlePointer(e,'A'));
    right.addEventListener('mousedown', (e)=>handlePointer(e,'B'));
    window.addEventListener('touchstart', globalTapHandler, {passive:false});
    window.addEventListener('click', globalTapHandler);

    resetMatch.addEventListener('click', (e)=>{
      // zapobiegamy propagacji klikniêcia do globalnego handlera
      e.stopPropagation();
      pointsA = pointsB = setsA = setsB = 0;
      updateHUD();
    });

    updateHUD();
  </script>
</body>
</html>

